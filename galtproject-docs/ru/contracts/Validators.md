# Контракт Validator - Требования

## Описание проблемы 
Необходимо внести в проект роль "Валидатор" с разным типом и обязанностями. Валидаторы должны проверять и утверждать запись земельных участков, был Кастодианами, разбирать земельные и имущественные споры и получать за это вознаграждение.

## Владелец контракта
TBD

## Сущности
- Роль контракта - роль контракта определяет полномочия группы адресов на выполнение администартивных методов контракта, например, `Оператор Валидаторов`, `Оператор Типов Заявок` и т.п.
- Тип заявки (`APPLICATION_TYPE`)- уникальный строковой идентификатор для контракта заявок. 
- Роль валидатора - уникальная роль валидатор, например `Аудитор`, `Кастодиан`, `Оценщик` и т.п.. Используется на различных этапах контрактов-заявок. Каждая роль валидатора привязана к `Типу заявки`.
- Валидатор - физические лица или организации, подтвеждающие своими действиями факты из реального мира. Может иметь 0..n ролей валидатора. В какой то мере здесь так же применим термин `Оракл`. Для осуществления своей деятельности валидаторы должны быть назначены `Оператором Валидаторов` и внести гарантийный залог за назначенную на него роль(и), определяемый `Оператором Депозитов`.

## Термины
- Аудитор - Валидатор с ролью `CM_AUDITOR`, которая имеет права обрабатывать заявки типа `ClaimManager` и учавствовать в AuditorsMultisig.

## Роли контракта
Роли контракта управляются его владельцем (`owner`)

- Оператор Валидаторов (`validator_manager`) - адрес(а), который может вызывать методы контракта по добавлению ролей, добавлению Адресов Валидаторов и и их измененению. Первончальной - адрес Galt Core. В дальнейшем будет переведено на контракт голосования.
- Оператор Типов Заявок (`application_type_manager`) - адрес(а), который может добавлять и удалять роли в типах заявок, назначать процентное соотношение вознаграждений этих ролей и их описания.
- Оператор Депозитов (`validator_stakes`) - адрес(а), который имеет право назначать и изменять необходимый депозит для конкретной роли валидатора


## Примеры ролей валидаторов

|Роль|Описание|
|--------|---------|
|Геодезист|Роль, задача которой выполнить проверку правильности определения границ участка при первичной регистрации|
|Юрист|Роль, задача которой выполнить права собственности заявителя на земельный участок|
|Кастодиан|Роль, задача которой являться формальным собственником земельного участка до перерегистрации его на владельца токена. Получает вознаграждение за операции и за то, что является формальным Владельцем земли|
|Аудитор|Роль, задача которой являться проверка сделки между Продавцом земли, Покупателем токена и Кастодианом|

## Типы заявок

|Тип|Описание|
|--------|---------|
|Первичная регистрация|Заявка выполняет первичную регистрацию земельного участка|
|Уточнение границ|Заявка выполняет уточнение границ и выпуск дополнительных геохешей|
|Продажа токена участка через Кастодиана|Фактически это контракт Эскроу, который выполняет продажу токена Участка с регистрацией Кастодиана по нему|
|Удаление Кастодиана с передачей земли Владельцу токена|Заявка при которой Кастодиан передает землю держателю токена и снимает с себя какие-либо обязательства.|

## Интерфейс взаимодействия с контрактом.
### Интерфейс для владельца контракта
#### #setValidatorStakesAddress
Владелец контракта устанавливает адрес контракта ValidatorStakes

### Интерфейс для fee manager
#### #setActiveRoleThreshold
Fee Manager устанавливает необходимый порог депозита, при достижении которого роль 

### Интерфейс для контракта ValidatorStakes

#### #notifyStakeChanged()
Изменяется значение депозита по паре адрес-роль

* Полученное значение сравнивается с требуемым порогом активности. В зависимости от этого возможны 3 действия:
    * Валидатор активируется
    * Валидатор деактивируется
    * Ничего не меняется



## Сценарии UI

### Сценарий: Добавление или удаление валидатора

1. Galt Space может устанавливать список адресов Валидаторов, которые могут подтверждать заявки, быть кастодианами и выполнять другие роли, их тип и дополнительные данные.

2. Galt Space может устанавливать количество валидаторов, которые нужны для принятия заявки и их тип.

3. В интерфейсе Galt Space или владельцы Galt Space видят кнопку `Администрирование`. При нажатии отображается кнопка `Контракт Validators`. 

4. При нажатии отображаются 2 таблицы.

5. Первая таблица - Типы валидаторов, необходимые для утверждения заявки, сгруппированные по типам заявок.

"Заявка на создание участка":

|Тип валидатора|Процент вознаграждения|
|---------|----------|
|Юрист|30|
|Геодезист|40|

Так же должна быть кнопка `Добавить`. При нажатии появляется поле для ввода Текста типа валидатора и вознаграждения. Просто добавляются новые поля для ввода.

При вводе размера вознаждения должна быть проверка, что это целые проценты.

Количество  ролей определяет, сколько нужно Валидаторов, чтобы утвердить или Отклонить заявку. Если ролей 2, то нужно два утверждения, если 1,то 1.

Если информация в полях и/или количество полей изменилось, то становится активна кнопка "Изменить данные", которая создает транзакцию с методом контракта Validators по полной перезаписи ролей в заявке и распределения дохода между ними. На клиенте происходит проверка, что сумма процентов по ролям равна 100%.

6. Вторая таблица.

|Адрес Валидатора|Название|Тип|Код страны|Расположение| Статус |
|----------|---------|----------|--------|-----------|-----------|
|0xJjdj4884.....783|Компания Шамшанов и Партнеры|Юрист|Ru|zexub373n|Активен|
|0xJjdj4884.....723|Геодезист Иван|Геодезист|Ru|zexub372n|Не Активен|

Для каждой записи есть кнопка `Изменить данные`. При нажатии открывается диалоговое окно с возможностью отредактировать поля и две кнопки "Подтвердить" и "Отклонить". Кнопка "Подтвердить" активна, если были изменения. При нажатии подтвердить - создается транзакция с методом контракта на перезапись всех данных по Валидатору одной транзакцией.

Есть кнока `Добавить Валидатора`. При нажатии появляются поля:

|Поле|Пример Значения|Тип|
|------|-------|------|
|Адрес Валидатора|0xJjdj4884.....71b|Адрес|
|Название|Компания Шамшанов и Партнеры|Строка|
|Роль|Юрист|Значение из контракта|
|Залог|1000 GALT|uint256|
|Расположение|zexub373n|Координаты в формате Геохеш или GPS координат|
|Поле для файла с описанием|Поле, куда вставляется файл с описанием|

Все поля обязательные.
После заполнения полей создается и подписывается транзакция на вызов метода контракта Validators. Новый Валидатор добавляется в контракт. Документ сохраняется в IPFS. Хеш документа - в контракт.

7. Galt Space может устанавливать залог валидатора. Пока залог не перечислен - валидатор не может быть активным.
