# Контракт SpaceAuctionPack - Документация

## Описание проблемы
В контракте [AddNewPlot](AddNewPlot.md) были созданые токены SPACE `Упаковки` большого Земельного участка и соответствующие им токены SPACE `Геохеш-участков`. При помощи контракта [CreateTerritory](CreateTerritory.md) была создана и утверждена `Заявка на Краудсейл` `Территории`. При помощи контрактов [GaltGenesisRegistry](GaltGenesisRegistry.md) и конкретного контракта [TerritoryCrowdsale](TerritoryCrowdsale.md) Территория была продана `Участникам проекта` за Эфиры в обмен на токены GALT. Необходимо обеспечить честное и прозрачное распределение токенов SPACE `Упаковок`, которые соответствуют конкретным `Земельным участкам` между `Участниками проекта.`

## Цели контракта
- SPACE токены нужно продавать на аукционе по максимально честной цене избежав недостатка традиционного аукциона, когда опоненты перебивают ставки по минимальному увеличению цены.
- Необходимо реализовать `Аукцион земли`, базируясь на абстрактном классе [Аукциона Викри](Аукцион-Викри.md) со всеми его требованиями.
- Обеспечить возможность сделать ставку только на токены SPACE, которые были в Заявке на Краудсейл.

## Основные требования
- Минимальная цена лота должна определяться `Заявкой на Краудсейл`;
- При вторичной продаже SPACE токена - необходимо обеспечить стандартную работу аукциона без возможности выпуска нового дочернего токена.
- Минимальная цена лота при повторном выставлении токена будет такой же, как при первичном.

## Входные данные

|Токен SPACE |Владелец|
|-----------------|----------|
|743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk|SPACEAuctionRegistry|
|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|SPACEAuctionRegistry|
|36374683bs7GEOw24qdhjsssdhhqgddqw47457w24qgumgga|SPACEAuctionRegistry|

|Параметр|Значение|
|-----|-----|
|ID `Заявки на Краудсейл`|643737234|

## Сценарий: Первичная продажа SPACE - токена `Упаковки`.
0. При запуске контракта вызывается метод и контракт SPACEAuctionRegistry смотрит по `Заявке на Краудсейл` 643737234, есть ли SPACE - токены, которые должны быть переданы `Фонду`. Если да, то SPACEAuctionRegistry передает их Фонду, указанному в 643737234.

|Токен SPACE |Владелец|
|-----------------|----------|
|36374683bs7GEOw24qdhjsssdhhqgddqw47457w24qgumgga|Фонд|

1. При запуске контракта контракт SPACEAuctionRegistry передает токены, которые включены в заявку 643737234 контракту  SpaceAuctionPack (по этом вопросу нужно решение!).

|Токен SPACE |Владелец|
|-----------------|----------|
|743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk|SpaceAuctionPack|
|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|SpaceAuctionPack|

2. Контрактом аукциона определено, что с момента первой ставки на `Земельный участок` до момента определения победителя проходит 42 дня.

3. Пользователь видит доступные SPACE - токены и делает ставку на любой токен или на все сразу, указывая Открытую и Закрытую ставку.

|Токен SPACE |Открытая ставка|Закрытая ставка|
|-----------------|----------|-----|
|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|2000|1200|

4. Контракт проверяет, что Закрытая ставка больше или равно Минимальной ставки из  `Заявки на Краудсейл` 643737234. Если нет - ошибка. Если да, то 2000 GALT переходят от Пользователя контракту SpaceAuctionPack.

5. Начинается отсчет времени завершения Аукциона.

6. Пользователь Б делает ставку на тот же участок. Контракт проверяет, что Закрытая ставка больше или равно Минимальной ставки из  `Заявки на Краудсейл` 643737234. Если нет - ошибка. Если да, то 2500 GALT переходят от Пользователя контракту SpaceAuctionPack.

|Токен SPACE |Открытая ставка|Закрытая ставка|
|-----------------|----------|-----|
|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|2500|1100|

7. Прошло 42 дня и любой может вызвать метод finishAuction. Пользователь с максимальной закрытой ставкой выигрывает. Это пользователь с Закрытой ставкой 1200 GALT. Пользователь получает разницу между своей Открытой ставки и Закрытой ставкой пользователя Б 2000 - 1100 = 900 GALT.

8. Пользовател Б получает обратно 2500 GALT.

9. Контракт SpaceAuctionPack передает Пользователю токен 686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd.

|Токен SPACE |Владелец|
|-----------------|----------|
|743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk|SpaceAuctionPack|
|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|Пользователь|

10. 1200 GALT перечисляется от SpaceAuctionPack в адрес Фонда, указанного в `Заявке на Краудсейл` 643737234.

11. Контракт вызывает метод mint() контракта [Reputation.md](Reputation.md)  и Пользователь получает 1200 пунктов Репутации в Фонде, указанном в `Заявке на Краудсейл` 643737234.


